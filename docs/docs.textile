h1. Longtail Video Player com plugin de hipervideo

<hr />

Este documento descreve o procedimento necessário para o uso e configuração do <a href="http://longtailvideo.com/">Longtail Video Player</a> acrescido do plugin de hipervideo. 

h2. Adicionando o player a uma página

Para adicionar o player do Longtail Video, acrescido dos plugins para hipervideo, é necessário colar na página o código do arquivo <tt><a href="embed.html">embed.html</a></tt>, presente no mesmo diretório deste documento.

Além disto, os arquivos <tt>player-viral.swf</tt>, <tt>swfobject.js</tt>, <tt>hipervideo.swf</tt> e <tt>statemanager.swf</tt> devem estar presentes no subdiretório <tt>./support</tt>, relativo ao caminho do diretório que contém o arquivo <tt>html</tt> a ser  alterado. Este diretório pode ser alterado se o código em <tt>embed.html</tt> for alterado coerentemente, nas linhas comentadas com:
* <tt>// PLAYER PATH HERE</tt>
* <tt>// SWFOBJECT.JS PATH HERE</tt>

Os dois primeiros arquivos podem ser encontrados <a href="./">aqui</a>. Os demais compõem o plugin de hipervideo e precisam ser compilados separadamente.

h2. Compilação do plugin

Para compilar o plugin de hipervideo, o SDK do Flex será necessário. Este pode ser obtido gratuitamente na página de <a href="http://www.adobe.com/products/flex/flexdownloads/">downloads</a> da Adobe.

Depois, o arquivo <tt>build.sh.example</tt> que acompanha esta distribuição, fica no diretório <tt>src/</tt> e deve ser copiado para um novo arquivo <tt>build.sh</tt>. Este, por sua vez, deve ser alterado, definindo o valor da variável <tt>FLEXPATH</tt> como a localização da instalação local SDK do Flex.

Por fim, basta executar o script <tt>build.sh</tt> para compilar o plugin, que será criado no diretório <tt>/bin-debug/plugins/hipervideo/</tt>.

h2. Variáveis do Longtail Video Player

No código do <tt>embed.html</tt> são definidas algumas variáveis do player, incluindo a localização do arquivo de vídeo a ser reproduzido. Esta configuração é determinada pela variável <tt>file</tt>, definida na linha comentada com:
* <tt>// VIDEO FILENAME HERE</tt>

Da mesma forma, a imagem de preview, exibida antes do início do vídeo, é determinada pela variável <tt>image</tt>, definida na linha comentada com:
* <tt>// VIDEO PREVIEW IMAGE HERE</tt>

Mais informações sobre as variáveis do Longtail Video Player podem ser obtidas no <a href="http://developer.longtailvideo.com/trac/wiki/FlashVars">site do produto</a>.

h2. Variáveis do plugin de hipervideo

Os dados de hipervideo são fornecidos por um arquivo XML que também deve ser informado como uma variável do player: <tt>hipervideo.file</tt>. Esta é definida na linha comentada com:
* <tt>// HIPERVIDEO DATA FILE HERE</tt>

O posicionamento das barras de vídeos relacionados e de links é determinado pela variável <tt>hipervideo.barposition</tt>, definida na linha comentada com:
* <tt>// BAR POSITION</tt>
	
Os valores possíveis são:

|<tt>bottom</tt>|Parte inferior da janela de exibição do vídeo|
|<tt>center</tt>|Parte central da janela de exibição do vídeo|
|<tt>top</tt>|Parte superior da janela de exibição do vídeo|

h2. Formato do XML

Os itens exibidos durante a execução do vídeo são descritos em um arquivo xml, determinado pela variável <tt>hipervideo.file</tt>. As tags mais elementares, que serão combinadas de forma a compor estes itens, são:

h3. Pause

Indica uma interrupção na execução do vídeo. Por exemplo:

<pre>
<pause at="00:01:05" />
</pre>

Especifica uma pausa no instante 1 minuto e 5 segundos do vídeo.

Opcionalmente, podemos usar um valor não inteiro para os segundos (por exemplo, 01:12:20.5).

h3. Link

Indica uma ação a ser executada.

<pre>
<link>
	<tooltip>Tooltip do link</tooltip>
	<url>http://url.para.um.site</url>
	<thumbnail>thumbnail.representando.link.jpg</thumbnail>
</link>
</pre>

A tag <tt>url</tt> indica a abertura de uma referência externa.
Essa tag aceita o modo de abertura da referência externa através da tag target. Os valores aceitos são:
* _blank, a referência será aberta em uma nova janela
* _self, a referência será aberta na mesma janela. Esse é o valor padrão.

Um exemplo de uso ficaria assim:

<pre>
<link>
	<tooltip>Tooltip do link</tooltip>
	<url target="_blank">http://url.para.um.site</url>
	<thumbnail>thumbnail.representando.link.jpg</thumbnail>
</link>
</pre>

<pre>
<link activity_id="parametro">
	<tooltip>Tooltip do link</tooltip>
	<time>01:01:05</time>
	<thumbnail>thumbnail.representando.link.jpg</thumbnail>
</link>
</pre>

A tag <tt>time</tt>, nesse caso, indica um salto para o momento 1 hora, 1 minuto e 5 segundos do vídeo. 

O parâmetro opcional activity_id, se presente, será passado como argumento para a função logActivity (caso o link seja clicado durante a execução).

Opcionalmente, a função logActivity pode devolver uma resposta. Essa resposta deve ser um Hash contendo dois pares, por exemplo:

<pre>
{
	id: 'Element', 
	value: {
		begin: 00:00:01, end: 00:00:05, 
		content: "Nota: A+", isText: true,
		textColor: '0xFF0000', backgroundColor: '',
		hasBackgroundColor: false, url: "",
		time: "", activityId: "", action: "",
		topLeft_x:20, topLeft_y:50,
		width:100, height:100, active:false}
}
</pre>

Aqui, temos:
* id, determinando o tipo da resposta
* value, determinando a resposta em si

Se <tt>id='Element'</tt>, <tt>value</tt> é entendido como um novo <tt>Element</tt> para ser exibido no vídeo, e deve ser descrito como visto no exemplo acima.

Podemos também passar um parâmetro chamado action com o valor de play, para que o link funcione como um botão de play, ou seja, se clicado, o vídeo continuará executando normalmente, como se fosse o botão de play do vídeo.

<pre>
<link action="play">
	<tooltip>Tooltip do link</tooltip>
	<thumbnail>thumbnail.representando.link.jpg</thumbnail>
</link>
</pre>

Podemos também passar qual será o vídeo a ser executado quando o elemento for clicado.
O vídeo DEVE SER OBRIGATORIAMENTE um xml, que indicará qual será o vídeo a ser exibido e todas os itens dele.

<pre>
<link>
	<tooltip>Tooltip do link</tooltip>
	<video>outro.video.xml</video>
	<thumbnail>thumbnail.representando.link.jpg</thumbnail>
</link>
</pre>

h3. Time

Indica um intervalo de tempo.

<pre>
<time start="00:02:00" duration="00:05:00"/>
</pre>

Especifica um intervalo de tempo do segundo ao quinto minuto do vídeo.

h3. Geometry

Indica uma posição na janela de exibição do vídeo.

<pre>
<geometry x="10" y="20" height="100" width="200"/>
</pre>

Os valores de x="10" e y="20" indicam, respectivamente, as coordenadas horizontal e vertical do canto superior esquerdo do item. 

Os valores height="100" e width="200" indicam, respectivamente, a altura e a largura do item.

Todos os valores são entendidos em pixels.

h3. Text Content

Indica um conteúdo textual.

<pre>
<textContent>
	<![CDATA[Um texto podendo usar <b>negrito</b>, <i>itálico</i> e <u>sublinhado</u>]]>
</textContent>
</pre>

Apenas negrito, itálico e sublinhado são suportados como formatação.

h3. Image Content

Indica uma imagem como conteúdo.

<pre>
<imageContent>imagem.gif</imageContent>
</pre>

h3. Underline

Indica uma área que ficará sublinhada, simulando um link. 

<pre>
<underline color="0x0000FF"/>
</pre>

É possível definir a cor do sublinhado através do atributo color, na tag underline.

h3. Frame

Indica uma área delimitada por uma borda. 

<pre>
<frame color="0x0000FF"/>
</pre>

É possível definir a cor do sublinhado através do atributo color, na tag frame.

h3. Element

Indica um elemento de hipervideo. Esse elemento pode ser de texto, por exemplo:

<pre>
<element>
	<textContent>
	<link>
	<time>
	<position>
</element>
</pre>

Ou de imagem:

<pre>
<element>
	<imageContent>
	<link>
	<time>
	<position>
</element>
</pre>

h3. Playlist

Indica uma coleção de vídeos relacionados.

<pre>
<playlist>
	<link>
	<link>
	...
	<link>
</playlist>
</pre>

h3. Actions

Indica as ações a serem realizadas durante a execução do vídeo

<pre>
<actions>
	<pause>
	<pause>
	...
	<pause>
</actions>
</pre>

h3. Elements

Indica uma coleção de elementos a serem exibidos durante a execução do vídeo.

<pre>
<elements>
	<element>
	<element>
	...
	<element>
</elements>
</pre>

h3. Video

Indica a raiz do arquivo xml.

<pre>
<video>
	<playlist>
	<actions>
	<elements>
</video>
</pre>

h2. Exemplo do XML

Pequeno exemplo do arquivo XML.

<pre>
<video>
	<!-- vídeos relacionados -->
	<playlist>
		<link>
			<tooltip>Tooltip para barra de links relacionados</tooltip>
			<url>http://url.para.algo.com.br</url>
			<thumbnail>thumbnail_do_link.jpg</thumbnail>
		</link>	
		<link>
			<tooltip>Segundo tooltip</tooltip>
			<url>http://outra.url.para.algo.com.br</url>
			<thumbnail>outro_thumbnail_do_link.jpg</thumbnail>
		</link>
	</playlist>

	<!-- ações realizadas automaticamente pelo player -->
	<actions>
		<!-- pausar automaticamente a execução do vídeo nos instantes 00:01:03 e 00:02:15 -->
		<pause at="00:01:03" />
		<pause at="00:02:15" />
	</actions>
	
	<!-- elementos exibidos durante a exibição do vídeo -->
	<elements>
		<!-- elementos de texto -->
		<element>
			<textContent>
				<![CDATA[Um texto podendo usar <b>negrito</b>, <i>itálico</i> e <u>sublinhado</u>]]>
			</textContent>
			<link>
				<tooltip>Tooltip para barra de links do vídeo</tooltip>
				<url>http://url_para_algo.com.br</url>
				<thumbnail>thumbnail_do_link.jpg</thumbnail>
			</link>
			<!-- os valores de início e fim da exibição do elemento, em formato hh:mm:ss -->
			<time start="00:04:10" duration="00:03:00"/>
			<!-- valores para x, y, height e width em pixels -->	
			<position x="10" y="30" height="200" width="300"/>
		</element>
		<!-- elementos de imagem -->
		<element>
			<imageContent>imagem.gif</imageContent>
			<!-- quando clicado irá executar a função logActivity com o argumento parametro_do_log -->
			<link activity_id="parametro_do_log">
				<tooltip>Tooltip para barra de links do vídeo</tooltip>
				<!-- quando clicado irá para a posição 01:12:44 do vídeo -->
				<time>01:12:44</time>
				<thumbnail>thumbnail_do_link.jpg</thumbnail>
			</link>
			<time start="00:25:32" duration="00:10:00"/>
			<position x="5" y="130" height="30" width="40"/>
		</element>
	</elements>
</video>
</pre>

Outro exemplo concreto <a href="../html-template/support/links.xml">também está disponível</a>.
